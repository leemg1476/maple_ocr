<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" class="h-100">
<!--  <head th:fragment="head(title)">-->
<!--    &lt;!&ndash; Required meta tags &ndash;&gt;-->
<!--    <meta charset="utf-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1">-->

<!--    &lt;!&ndash; Bootstrap CSS &ndash;&gt;-->
<!--    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">-->

<!--    <link href="cover.css" th:href="@{/cover.css}" rel="stylesheet">-->
<!--    <title th:text="${title}">mapleOcr</title>-->
<!--  </head>-->
<!--  <body class="d-flex h-100 text-center text-white">-->

<!--    <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column" th:fragment="default">-->
<!--      <header class="mb-auto">-->
<!--        <div>-->
<!--          <nav class="nav nav-masthead justify-content-center float-md-start">-->
<!--            <a href="/index.html" onclick="location.href='/'" style="color: white; text-decoration: none;"><h3>MQ</h3></a>-->
<!--          </nav>-->
<!--        </div>-->
<!--      </header>-->

<!--      <main class="px-3">-->
<!--        <a href="/index.html" onclick="location.href='/'" style="color: white; text-decoration: none;"><h1>MapleStory DailyQuest</h1></a>-->

<!--        <div class="image-upload" id="image-upload">-->
<!--        <form method="get" enctype="multipart/form-data">-->
<!--          <div class="button">-->
<!--            <label for="chooseimg">-->
<!--              ğŸ‘‰ CLICK HERE! ğŸ‘ˆ-->
<!--            </label>-->
<!--          </div>-->
<!--          <input type="file" accept="image/*" name="chooseimg" id="chooseimg">-->
<!--        </form>-->
<!--      </div>-->
<!--      </main>-->

<!--      <footer class="mt-auto text-white-50">-->
<!--        <p>Cover template for <a href="https://getbootstrap.com/" class="text-white">Bootstrap</a>, by <a href="https://twitter.com/mdo" class="text-white">@mdo</a>.</p>-->
<!--      </footer>-->
<!--    </div>-->
<!--  </body>-->

  <body>

    <input type="file" accept="image/*" name="img" id="image" onchange="test(this)">

    <script>
        function test(input){
      // ì´ë¯¸ì§€ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
      var file = input.files[0];

      // ì´ë¯¸ì§€ ë³€ìˆ˜ ì„ ì–¸ ë° ì´ˆê¸°í™”
      var newImage = document.createElement("img");
      newImage.setAttribute("class", 'img');

      // ì´ë¯¸ì§€ ì†ì„± ì§€ì • : file, ê°€ë¡œ, ì„¸ë¡œ ë“±
      newImage.src = URL.createObjectURL(file);
      newImage.style.width = "100%";
      newImage.style.height = "100%";
      newImage.style.objectFit = "contain";




      // ì´ë¯¸ì§€ ì²˜ë¦¬ ì‘ì—…

      var pyshell = require("python-shell")
      var fs = require("fs");
      const { PythonShell } = require("python-shell");

      // var data = fs.readFileSync("./image_07.jpg")
      var data = fs.readFileSync(newImage)
      var base64 = data.toString("base64");

      //íŒŒì´ì¬.pyíŒŒì¼ê³¼, ì‹¤í–‰ì‹œí‚¬ python í”„ë¡œê·¸ë¨ì˜ ê²½ë¡œë¥¼ ë¬¸ìì—´ë¡œ ì…ë ¥
      // ocr íŒŒì¼ëª…ìœ¼ë¡œ ë³€ê²½í•˜ê¸°!!
      pyshell = new PythonShell('scripts.py');

      //base64ë¡œ ì¸ì½”ë”©í•œ ë¬¸ìì—´ì„ ì „ì†¡
      pyshell.send(base64);

      pyshell.on("message", rebase64 => {
          var err = null;

          //base64 ë¬¸ìì—´ì„  Buffer(bytes)íƒ€ì…ìœ¼ë¡œ ë””ì½”ë”©
          result = Buffer.from(rebase64,"base64");
          console.log(result);
          fs.writeFileSync("result.jpg", result);
      });

      pyshell.end(err => {
      if (err) {
          console.log(err);
      }
      });

      //





      // ì´ë¯¸ì§€ ë³´ì´ëŠ” ê³³(div : image-show)ì— ì´ë¯¸ì§€ íŒŒì¼ ì¶”ê°€
      var container = document.getElementById('image-show');
      container.appendChild(newImage);
      container.style.visibility = "visible";

      // íŒŒì¼ ì´ë¦„ì€ ë³´ì´ì§€ ì•Šê²Œ ì„¤ì •
      file.textContent = null;

      var newImage = document.getElementById('image-show').lastElementChild;

      //ì´ë¯¸ì§€ëŠ” í™”ë©´ì— ë‚˜íƒ€ë‚˜ê³ 
      newImage.style.visibility = "visible";

      //ì´ë¯¸ì§€ ì—…ë¡œë“œ ë²„íŠ¼ì€ ìˆ¨ê²¨ì§„ë‹¤
      document.getElementById('image-upload').style.visibility = 'hidden';

  }
    </script>



  </body>
</html>